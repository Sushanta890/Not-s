<!DOCTYPE html>
<html>
<head>
  <title>Room Purchase View</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #fff4f4; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #999; padding: 8px; text-align: center; }
    button { margin-top: 20px; padding: 10px; background: red; color: white; border: none; }
  </style>
</head>
<body>
  <h2>Room Purchase Summary</h2>
  <div id="table"></div>
  <div id="totals"></div>
  <button onclick="downloadPDF()">üìÑ Download PDF</button>

  <script>
    const data = JSON.parse(localStorage.getItem("roomData") || "[]");
    let html = `<table><tr><th>Item</th><th>KG</th><th>Gram</th><th>Rs</th><th>Date</th><th>Time</th></tr>`;
    let totalDay = 0, totalWeek = 0, totalMonth = 0, totalYear = 0;

    const now = new Date();

    data.forEach(item => {
      const dt = new Date(item.date);
      const dateStr = dt.toLocaleDateString();
      const timeStr = dt.toLocaleTimeString();
      html += `<tr><td>${item.name}</td><td>${item.kg}</td><td>${item.gram}</td><td>‚Çπ${item.rs}</td><td>${dateStr}</td><td>${timeStr}</td></tr>`;

      const diffDays = Math.floor((now - dt) / (1000 * 60 * 60 * 24));

      if (diffDays === 0) totalDay += item.rs;
      if (diffDays <= 7) totalWeek += item.rs;
      if (now.getMonth() === dt.getMonth() && now.getFullYear() === dt.getFullYear()) totalMonth += item.rs;
      if (now.getFullYear() === dt.getFullYear()) totalYear += item.rs;
    });

    html += `</table>`;
    document.getElementById("table").innerHTML = html;

    document.getElementById("totals").innerHTML = `
      <h3>Total Rs:</h3>
      <p>üóìÔ∏è Today: ‚Çπ${totalDay}</p>
      <p>üìÖ This Week: ‚Çπ${totalWeek}</p>
      <p>üìÜ This Month: ‚Çπ${totalMonth}</p>
      <p>üìà This Year: ‚Çπ${totalYear}</p>
    `;

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(14);
      doc.text("Room Purchase Report", 20, 20);

      let y = 30;
      data.forEach((item, i) => {
        const dt = new Date(item.date);
        doc.text(`${i+1}. ${item.name} - ‚Çπ${item.rs} (${dt.toLocaleString()})`, 20, y);
        y += 10;
        if (y > 270) {
          doc.addPage();
          y = 20;
        }
      });

      doc.text(`\nTotal Today: ‚Çπ${totalDay}`, 20, y + 10);
      doc.text(`Total Week: ‚Çπ${totalWeek}`, 20, y + 20);
      doc.text(`Total Month: ‚Çπ${totalMonth}`, 20, y + 30);
      doc.text(`Total Year: ‚Çπ${totalYear}`, 20, y + 40);

      doc.save("Room_Purchase_Report.pdf");
    }
  </script>
</body>
</html>
